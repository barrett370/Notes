<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="My University Notes Site.">
<title>
 - Welcome to my Notes Repo!
</title>




<link rel="shortcut icon" href="/Notes/sam.ico">








<link rel="stylesheet" href="/Notes/css/main.min.81bbafc4df93b11c1c3e2449464373c384aa4903731b4fc7a77dfcdd979e184f.css" integrity="sha256-gbuvxN&#43;TsRwcPiRJRkNzw4SqSQNzG0/Hp3383ZeeGE8=" crossorigin="anonymous" media="screen">



 

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sam-barrett.codes/Notes/tn.png"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Lecture 8 SMs, Cores and Warps  A GPU has a number of Streaming Multiprocessors (SMs) which have a number of cores. Threads are scheduled in units of Warps Each SM has a number of resources  E.g 400-500 series Nvidia GPUs have: 2 Instruction despatch units  Each can start, on each clock cycle, processing on any 2 banks at a time. The 3 banks of 16 cores mean that 2 sequential instructions from one thread warp can be executing simultaneously if are not dependent on each other  3 banks of 16 cores (48 cores) 1 bank of 16 load store units  for calculating source and destination addresses  1 bank of 4 special functional units  hardware support for calculating $\sin$, $\cos$, reciprocals and square roots  1 bank of 4 texture units    GPU specs:  Global Memory and constant memory is the only GPU memory that you can copy into."/>

<meta property="og:title" content="" />
<meta property="og:description" content="Lecture 8 SMs, Cores and Warps  A GPU has a number of Streaming Multiprocessors (SMs) which have a number of cores. Threads are scheduled in units of Warps Each SM has a number of resources  E.g 400-500 series Nvidia GPUs have: 2 Instruction despatch units  Each can start, on each clock cycle, processing on any 2 banks at a time. The 3 banks of 16 cores mean that 2 sequential instructions from one thread warp can be executing simultaneously if are not dependent on each other  3 banks of 16 cores (48 cores) 1 bank of 16 load store units  for calculating source and destination addresses  1 bank of 4 special functional units  hardware support for calculating $\sin$, $\cos$, reciprocals and square roots  1 bank of 4 texture units    GPU specs:  Global Memory and constant memory is the only GPU memory that you can copy into." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sam-barrett.codes/Notes/modules/parallel-distributed/source/parallel-dist-lecture8/" />

<meta property="og:image" content="https://sam-barrett.codes/Notes/tn.png" />
<meta property="og:site_name" content="Notes" />


    

    
    
    
    <title>
        
        
        
    </title>
</head>

<body>
    <div class="wrap">
        <div class="section" id="title"></div>

        <div class="section" id="content">

<h1 id="lecture-8">Lecture 8</h1>

<h2 id="sms-cores-and-warps">SMs, Cores and Warps</h2>

<ul>
<li>A GPU has a number of <em>Streaming Multiprocessors (SMs)</em> which have a number of <em>cores</em>. Threads are scheduled in units of <em>Warps</em></li>
<li>Each SM has a number of resources

<ul>
<li>E.g 400-500 series Nvidia GPUs have:</li>
<li>2 Instruction despatch units

<ul>
<li>Each can start, on each clock cycle, processing on any 2 banks at a time. The 3 banks of 16 cores mean that 2 sequential instructions from one thread warp can be executing simultaneously if are not dependent on each other</li>
</ul></li>
<li>3 banks of 16 cores (48 cores)</li>
<li>1 bank of 16 load store units

<ul>
<li>for calculating source and destination addresses</li>
</ul></li>
<li>1 bank of 4 special functional units

<ul>
<li>hardware support for calculating $\sin$, $\cos$, reciprocals and square roots</li>
</ul></li>
<li>1 bank of 4 texture units
<br /></li>
</ul></li>
</ul>

<h2 id="gpu-specs">GPU specs:</h2>

<ul>
<li><p>Global Memory and constant memory is the only GPU memory that you can copy into.</p>

<ul>
<li><p>constant memory can only be edited by the host</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">&lt;&lt;</span>  <span style="color:#960050;background-color:#1e0010">./deviceQuery</span>
<span style="color:#960050;background-color:#1e0010">&gt;&gt;</span>  <span style="color:#960050;background-color:#1e0010">./DeviceQuery/Debug/deviceQuery</span> <span style="color:#960050;background-color:#1e0010">Starting...</span>


<span style="color:#960050;background-color:#1e0010">Device</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;GeForce RTX 2070&#34;</span>
<span style="color:#960050;background-color:#1e0010">CUDA</span> <span style="color:#960050;background-color:#1e0010">Driver</span> <span style="color:#960050;background-color:#1e0010">Version</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#960050;background-color:#1e0010">Runtime</span> <span style="color:#960050;background-color:#1e0010">Version</span>          <span style="color:#ae81ff">10.1</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#ae81ff">10.1</span>
<span style="color:#960050;background-color:#1e0010">CUDA</span> <span style="color:#960050;background-color:#1e0010">Capability</span> <span style="color:#960050;background-color:#1e0010">Major/Minor</span> <span style="color:#960050;background-color:#1e0010">version</span> <span style="color:#960050;background-color:#1e0010">number:</span>    <span style="color:#ae81ff">7.5</span>
<span style="color:#960050;background-color:#1e0010">Total</span> <span style="color:#960050;background-color:#1e0010">amount</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">global</span> <span style="color:#960050;background-color:#1e0010">memory:</span>                 <span style="color:#ae81ff">7982</span> <span style="color:#960050;background-color:#1e0010">MBytes</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#ae81ff">8370061312</span> <span style="color:#960050;background-color:#1e0010">bytes)</span>
<span style="color:#960050;background-color:#1e0010">(</span><span style="color:#ae81ff">36</span><span style="color:#960050;background-color:#1e0010">)</span> <span style="color:#960050;background-color:#1e0010">Multiprocessors,</span> <span style="color:#960050;background-color:#1e0010">(</span> <span style="color:#ae81ff">64</span><span style="color:#960050;background-color:#1e0010">)</span> <span style="color:#960050;background-color:#1e0010">CUDA</span> <span style="color:#960050;background-color:#1e0010">Cores/MP:</span>     <span style="color:#ae81ff">2304</span> <span style="color:#960050;background-color:#1e0010">CUDA</span> <span style="color:#960050;background-color:#1e0010">Cores</span>
<span style="color:#960050;background-color:#1e0010">GPU</span> <span style="color:#960050;background-color:#1e0010">Max</span> <span style="color:#960050;background-color:#1e0010">Clock</span> <span style="color:#960050;background-color:#1e0010">rate:</span>                            <span style="color:#ae81ff">1710</span> <span style="color:#960050;background-color:#1e0010">MHz</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#ae81ff">1.71</span> <span style="color:#960050;background-color:#1e0010">GHz)</span>
<span style="color:#960050;background-color:#1e0010">Memory</span> <span style="color:#960050;background-color:#1e0010">Clock</span> <span style="color:#960050;background-color:#1e0010">rate:</span>                             <span style="color:#ae81ff">7001</span> <span style="color:#960050;background-color:#1e0010">Mhz</span>
<span style="color:#960050;background-color:#1e0010">Memory</span> <span style="color:#960050;background-color:#1e0010">Bus</span> <span style="color:#960050;background-color:#1e0010">Width:</span>                              <span style="color:#ae81ff">256</span><span style="color:#960050;background-color:#1e0010">-bit</span>
<span style="color:#960050;background-color:#1e0010">L</span><span style="color:#ae81ff">2</span> <span style="color:#960050;background-color:#1e0010">Cache</span> <span style="color:#960050;background-color:#1e0010">Size:</span>                                 <span style="color:#ae81ff">4194304</span> <span style="color:#960050;background-color:#1e0010">bytes</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">Texture</span> <span style="color:#960050;background-color:#1e0010">Dimension</span> <span style="color:#960050;background-color:#1e0010">Size</span> <span style="color:#960050;background-color:#1e0010">(x,y,z)</span>         <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">D=(</span><span style="color:#ae81ff">131072</span><span style="color:#960050;background-color:#1e0010">),</span> <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">D=(</span><span style="color:#ae81ff">131072</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">65536</span><span style="color:#960050;background-color:#1e0010">),</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">D=(</span><span style="color:#ae81ff">16384</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">16384</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">16384</span><span style="color:#960050;background-color:#1e0010">)</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">Layered</span> <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">D</span> <span style="color:#960050;background-color:#1e0010">Texture</span> <span style="color:#960050;background-color:#1e0010">Size,</span> <span style="color:#960050;background-color:#1e0010">(num)</span> <span style="color:#960050;background-color:#1e0010">layers</span>  <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">D=(</span><span style="color:#ae81ff">32768</span><span style="color:#960050;background-color:#1e0010">),</span> <span style="color:#ae81ff">2048</span> <span style="color:#960050;background-color:#1e0010">layers</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">Layered</span> <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">D</span> <span style="color:#960050;background-color:#1e0010">Texture</span> <span style="color:#960050;background-color:#1e0010">Size,</span> <span style="color:#960050;background-color:#1e0010">(num)</span> <span style="color:#960050;background-color:#1e0010">layers</span>  <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">D=(</span><span style="color:#ae81ff">32768</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">32768</span><span style="color:#960050;background-color:#1e0010">),</span> <span style="color:#ae81ff">2048</span> <span style="color:#960050;background-color:#1e0010">layers</span>
<span style="color:#960050;background-color:#1e0010">Total</span> <span style="color:#960050;background-color:#1e0010">amount</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">constant</span> <span style="color:#960050;background-color:#1e0010">memory:</span>               <span style="color:#ae81ff">65536</span> <span style="color:#960050;background-color:#1e0010">bytes</span>
<span style="color:#960050;background-color:#1e0010">Total</span> <span style="color:#960050;background-color:#1e0010">amount</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">shared</span> <span style="color:#960050;background-color:#1e0010">memory</span> <span style="color:#960050;background-color:#1e0010">per</span> <span style="color:#960050;background-color:#1e0010">block:</span>       <span style="color:#ae81ff">49152</span> <span style="color:#960050;background-color:#1e0010">bytes</span>
<span style="color:#960050;background-color:#1e0010">Total</span> <span style="color:#960050;background-color:#1e0010">number</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">registers</span> <span style="color:#960050;background-color:#1e0010">available</span> <span style="color:#960050;background-color:#1e0010">per</span> <span style="color:#960050;background-color:#1e0010">block:</span> <span style="color:#ae81ff">65536</span>
<span style="color:#960050;background-color:#1e0010">Warp</span> <span style="color:#960050;background-color:#1e0010">size:</span>                                     <span style="color:#ae81ff">32</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">number</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">threads</span> <span style="color:#960050;background-color:#1e0010">per</span> <span style="color:#960050;background-color:#1e0010">multiprocessor:</span>  <span style="color:#ae81ff">1024</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">number</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">threads</span> <span style="color:#960050;background-color:#1e0010">per</span> <span style="color:#960050;background-color:#1e0010">block:</span>           <span style="color:#ae81ff">1024</span>
<span style="color:#960050;background-color:#1e0010">Max</span> <span style="color:#960050;background-color:#1e0010">dimension</span> <span style="color:#960050;background-color:#1e0010">size</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">a</span> <span style="color:#960050;background-color:#1e0010">thread</span> <span style="color:#960050;background-color:#1e0010">block</span> <span style="color:#960050;background-color:#1e0010">(x,y,z):</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#ae81ff">1024</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">1024</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">64</span><span style="color:#960050;background-color:#1e0010">)</span>
<span style="color:#960050;background-color:#1e0010">Max</span> <span style="color:#960050;background-color:#1e0010">dimension</span> <span style="color:#960050;background-color:#1e0010">size</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">a</span> <span style="color:#960050;background-color:#1e0010">grid</span> <span style="color:#960050;background-color:#1e0010">size</span>    <span style="color:#960050;background-color:#1e0010">(x,y,z):</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#ae81ff">2147483647</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">65535</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#ae81ff">65535</span><span style="color:#960050;background-color:#1e0010">)</span>
<span style="color:#960050;background-color:#1e0010">Maximum</span> <span style="color:#960050;background-color:#1e0010">memory</span> <span style="color:#960050;background-color:#1e0010">pitch:</span>                          <span style="color:#ae81ff">2147483647</span> <span style="color:#960050;background-color:#1e0010">bytes</span>
<span style="color:#960050;background-color:#1e0010">Texture</span> <span style="color:#960050;background-color:#1e0010">alignment:</span>                             <span style="color:#ae81ff">512</span> <span style="color:#960050;background-color:#1e0010">bytes</span>
<span style="color:#960050;background-color:#1e0010">Concurrent</span> <span style="color:#960050;background-color:#1e0010">copy</span> <span style="color:#960050;background-color:#1e0010">and</span> <span style="color:#960050;background-color:#1e0010">kernel</span> <span style="color:#960050;background-color:#1e0010">execution:</span>          <span style="color:#960050;background-color:#1e0010">Yes</span> <span style="color:#960050;background-color:#1e0010">with</span> <span style="color:#ae81ff">3</span> <span style="color:#960050;background-color:#1e0010">copy</span> <span style="color:#960050;background-color:#1e0010">engine(s)</span>
<span style="color:#960050;background-color:#1e0010">Run</span> <span style="color:#960050;background-color:#1e0010">time</span> <span style="color:#960050;background-color:#1e0010">limit</span> <span style="color:#960050;background-color:#1e0010">on</span> <span style="color:#960050;background-color:#1e0010">kernels:</span>                     <span style="color:#960050;background-color:#1e0010">No</span>
<span style="color:#960050;background-color:#1e0010">Integrated</span> <span style="color:#960050;background-color:#1e0010">GPU</span> <span style="color:#960050;background-color:#1e0010">sharing</span> <span style="color:#960050;background-color:#1e0010">Host</span> <span style="color:#960050;background-color:#1e0010">Memory:</span>            <span style="color:#960050;background-color:#1e0010">No</span>
<span style="color:#960050;background-color:#1e0010">Support</span> <span style="color:#960050;background-color:#1e0010">host</span> <span style="color:#960050;background-color:#1e0010">page-locked</span> <span style="color:#960050;background-color:#1e0010">memory</span> <span style="color:#960050;background-color:#1e0010">mapping:</span>       <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Alignment</span> <span style="color:#960050;background-color:#1e0010">requirement</span> <span style="color:#960050;background-color:#1e0010">for</span> <span style="color:#960050;background-color:#1e0010">Surfaces:</span>            <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Device</span> <span style="color:#960050;background-color:#1e0010">has</span> <span style="color:#960050;background-color:#1e0010">ECC</span> <span style="color:#960050;background-color:#1e0010">support:</span>                        <span style="color:#960050;background-color:#1e0010">Disabled</span>
<span style="color:#960050;background-color:#1e0010">Device</span> <span style="color:#960050;background-color:#1e0010">supports</span> <span style="color:#960050;background-color:#1e0010">Unified</span> <span style="color:#960050;background-color:#1e0010">Addressing</span> <span style="color:#960050;background-color:#1e0010">(UVA):</span>      <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Device</span> <span style="color:#960050;background-color:#1e0010">supports</span> <span style="color:#960050;background-color:#1e0010">Compute</span> <span style="color:#960050;background-color:#1e0010">Preemption:</span>            <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Supports</span> <span style="color:#960050;background-color:#1e0010">Cooperative</span> <span style="color:#960050;background-color:#1e0010">Kernel</span> <span style="color:#960050;background-color:#1e0010">Launch:</span>            <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Supports</span> <span style="color:#960050;background-color:#1e0010">MultiDevice</span> <span style="color:#960050;background-color:#1e0010">Co-op</span> <span style="color:#960050;background-color:#1e0010">Kernel</span> <span style="color:#960050;background-color:#1e0010">Launch:</span>      <span style="color:#960050;background-color:#1e0010">Yes</span>
<span style="color:#960050;background-color:#1e0010">Device</span> <span style="color:#960050;background-color:#1e0010">PCI</span> <span style="color:#960050;background-color:#1e0010">Domain</span> <span style="color:#960050;background-color:#1e0010">ID</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#960050;background-color:#1e0010">Bus</span> <span style="color:#960050;background-color:#1e0010">ID</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#960050;background-color:#1e0010">location</span> <span style="color:#960050;background-color:#1e0010">ID:</span>   <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#ae81ff">11</span> <span style="color:#960050;background-color:#1e0010">/</span> <span style="color:#ae81ff">0</span></code></pre></div></li>
</ul></li>
</ul>

<p><strong>Note:</strong></p>

<ul>
<li>1 core = 1 processing unit and can execute 1 thread</li>
<li>1 Warp = 32 cores</li>
</ul>

<p>Key details from printout above:</p>

<ul>
<li>36 SMs</li>
<li>64 cores/SM (=2304 CUDA cores total)</li>
<li>Maximum of 1024 threads/ SM</li>
<li>Maximum of 1024 threads/block</li>
<li>Maximum GPU clock rate of 1.71 GHz</li>
</ul>

<p>When a <em>kernel</em> is invoked with a configuration of Grid, Blocks and Threads</p>

<ul>
<li>Each block is assigned to a SM (streaming multi-processor) based on availability</li>
<li>Max 1024 threads/block $\implies$ 2 blocks can be <em>in flight</em> on each SM

<ul>
<li>This can be increased by having less threads allocated to each block</li>
</ul></li>
<li>When a block is assigned to a SM, the warps of the block are distributed statically among the warp schedulers</li>
<li>With a maximum of 1024 threads/SM (32 warps) each warp scheduler gets at most 8 warps (due to each SM having 4 warp schedulers &lt;&lt; <strong>Check</strong>)</li>
<li>Maximum number of blocks/SM is <strong>??</strong></li>
<li>Each scheduler can issue to to 2 independent instruction from the same warp each cycle</li>
</ul>

<h2 id="syncronisation">Syncronisation</h2>

<ul>
<li>Warps execute in lock-step

<ul>
<li>so synchronisation within a warp is mostly automatic but (data variables should be marked <code>volatile</code>)</li>
<li>In practice, it is much more complex</li>
<li>We need to be able to synchronise threads in a block</li>
<li>We also need to be able to synchronise threads in a warp</li>
<li>Cannot synchronise across different blocks</li>
<li><strong>Barrier synchronisation:</strong> <code>__syncthreads()</code></li>
<li>Must <strong>Never</strong> have <code>__syncthreads()</code> in a branch of a conditional that some threads in the block will not execute</li>
<li>else a deadlock will occur.</li>
</ul></li>
</ul>

<h2 id="more-on-warps">More on Warps</h2>

<ul>
<li><p>For threads in a block</p>

<ul>
<li>Warp 0 consists of threads 0 $\rightarrow$ 31</li>
<li>Warp 1 consists of threads 32 $\rightarrow$ 63</li>
<li>$\vdots$</li>
</ul></li>

<li><p>For threads in a mutli-dimensional block</p>

<ul>
<li>Mutlidimensional threads are linearised in a row-major order</li>
</ul></li>
</ul>
</div>

        
        <div class="section bottom-menu">
<hr />
<p>


    

    
        
            <a href="/Notes/modules/neural-computation/">Neural Computation</a>
        
    
    
        
            &#183; 
            <a href="/Notes/modules/machine-learning/">Machine Learning</a>
        
            &#183; 
            <a href="/Notes/modules/parallel-distributed/">Distributed and Parallel Computing</a>
        
    
    &#183; 
    <a href="https://sam-barrett.codes/Notes/">
        main
    </a>

</p></div>
        

        <div class="section footer"></div>
    </div>
</body>

</html>